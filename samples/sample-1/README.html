<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="utf-8">
    <link type="text/css" rel="stylesheet" media="all" href="../../resources/dart-squid-defaults.css">

    <title>SVG/DART WIDGETS</title>
</head>
<body>
<h1>THESE WIDGETS ARE IN EARLY STAGES AND THINGS CHANGE QUICKLY</h1>
<h2>PREFACE</h2>
<p>These Widgets currently only work in Dartium / Chrome.
</p>
<p>Open the Developer Tools Console for some tracing information (Chrome/Dartium) : via
Tools, Developer Tools or right-click (anywhere on page) and "Inspect Element", Console.
</p>
<p>Library and/or Class and Type names are subject to change (likely)
</p>
<p>
Reported bug(s) are preventing the standalone (non-HTML-"wrapped") SVG doc version
from working currently.
</p>
<h2>INTRODUCTION</h2>
<p>
Are you familiar with what a Delphi VCL TPanel control is?
It is a visual container with all sorts of options for borders, positioning, sizing,
and alignment.  Well, the base SVG Widget here is modeled after the TPanel in some ways,
and extends it quite a bit too with additional constraint-specifiers and other features.
</p>
<p>
The objective was to create a pure-SVG UI Component set.  Why?  Why not use Canvas, etc?
SVG already has some nice features (per specification at least) for handling events, for
managing nested visual objects, and all sorts of other stuff.  And, it was hoped that the
SVG-renderers (in various browsers and on various platforms) would do a better job of
maintaining visual consistency in the rendering of SVG docs than they do at consistently
rendering HTML docs.  In the end, SVG may likely suffer many of the same cross-browser
implementation consistency issues as HTML, but I figured: why not try?
</p>
<p>
In addition, the S and V in SVG (Scalable Vector Graphics) really had my interest.
It only seemed to make total sense to implement modern UIs using a vector-based approach
so that, regardless of device resolution or pixel-density, etc., the rendered visuals
would be ready to scale perfectly to fit any device.
</p>
<p>
Visual-alignment functionality was a core concern when building this framework.
Essentiallly, adaptive and flexible UI layouts that are available to modern desktop
applications were something I hoped to emulate within the browser inside SVG documents.
The end goal was to make component-based application-development in the browser quite
similar to what is obtainable with tools like Delphi.
</p>
<p>
An eventual component-hierarchy should look similar to that of other UI frameworks
like Delphi, DotNet, etc.
</p>
<p>
The event-model used by these components will look quite familiar to anyone that has
worked with desktop applicaiton development in Delphi.  Events are simply properties
that take a callback routine.  And, pre-defined events will have event-hooks for things
like onBeforeShow, onAfterShow, etc. in order to make creating applications in SVG
much like creating an application in Delphi. Development should appear "DOM-less"
(to programmers) as all the details of interacting with the SVG (and/or HTML) DOM
is wrapped up an hidden behind just standard Dart-language code.
</p>
<p>
Dart, by the way, has enough similarity to Delphi for most Delphi developers to
quickly adapt to it; especially if they are able to work with frameworks designed
like these SVG widgets.
</p>
<h2>REMINDER OF STATUS</h2>
<p>Again, THESE COMPONENTS ARE IN THE VERY EARLY STAGES OF DEVELOPMENT, but they should
at least prove to be intriguing or inspire the thought: "this developer is insane" :)
</p>
<p>
There is no guarantee these components will ever mature into fully production-ready
code, but as of now (August 2012), work is still progressing on a somewhat regular basis.
</p>
<p>
Enjoy!
<br />
mike
</p>
<h1>SVG REFERENCES AND NOTES</h1>
<p>
To see what SVG Element Attributes are available for our needs, and how they can be used,
refer to:
<pre>
http://www.w3.org/TR/SVG/attindex.html (note: we do not implement all of these attributes)

▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪
Styling of SVG elements -- see these related references:
    http://www.w3.org/TR/SVG/styling.html
    http://www.w3.org/TR/SVG/styling.html#SVGStylingProperties -lists which SVG attrs can be styled
    http://www.w3.org/TR/SVG/styling.html#StylingWithCSS - examples of inline vs referenced CSS file
    http://www.w3.org/TR/SVG/styling.html#StyleAttribute - inline "style" attr

Shapes have these stylable attributes to name a few:
    fill-opacity:
    fill:
    fill-rule:
    stroke:
    stroke-opacity:
    stroke-width:
    stroke-linecap:
    stroke-linejoin:
    stroke-dasharray:
    stroke-dashoffset:

Text has these stylable attributes (see: http://www.w3.org/TR/SVG/text.html)
    font-family: ;
    font-size: ;
    font-style: ;
    font-weight: ;
    text-anchor: ;

</pre>
</p>
<h1>WIDGET-SET DESIGN CONSIDERATIONS AND NOTES FOLLOW</h1>
<p>These are just some things being considered yet as functionality is implemented.
</p>
<h2>Issues Affecting Multiple Classes</h2>
<p>
<pre>
Rename Sides to Dimensions?  Not sure if this will add much clarity.

AlignSpec class is one example... we use _Dimension as variable name for the
simple reason that we can align not just to a "side", but also to things like
a center-point (clearly, a "dimension" vs. side).
</pre>
</p>
<h2>Widget (base class)</h2>
<h3>Styling of Widgets</h3>
<pre>
CONSIDER IMPLEMENTING pseudo-classes handling for STYLING OF Widget.
The CSS intentions should parsed and passed through to appropriate events.

E:active, E:hover, E:focus as used like this:
    rect:focus {
        cursor: move;
    }


▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪
Currently, only a certain group of attributes is targetable via CSS class selectors, since
the Widget internally transfers styling information and applies as needed to Widget parts.

Do we want to also allow use of inline-styling (in additon to class-selectors), whereby we
allow developer to pass an arbitrary style directive to various sub-components of a widget?

    e.g., style="fill: red; stroke: blue; "

Either way, we could ONLY use inline style approach for values not affecting
Widget Metrics (i.e., anything that affects width/height of ANY component of the widget),
so that would leave us with things like, perhaps:

    - filter effectss
    - other effects (gradients, fills, coloring, painting, lighting, etc)
    - pointer-events
    - clipping/masking
    - text properties / font properties (espec in sub-classes implementing text)

▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪
Do we want to implment some "standard" Gradient abilities and enumeration, perhaps like:
    TGradientDirection (a la Delphi) = ( gdDiagonalUp, gdDiagonalDown,
        gdHorizontalEnd, gdHorizontalCenter, gdHorizontalBox,
        gdVerticalEnd, gdVerticalCenter, gdVerticalBox,
        gdSquareBox, gdBigSquareBox );

</pre>
<h3>Tags and Tabstops</h3>
</p>These need to interact with managed lists in Application.  TabStops should be unique within
any parent. Tags should probably be unique to Application.
</p>




<h1>Current Tasks to Work On</h1>
<h2>General</h2>
<pre>Search code for "TODO" items to work on; there are plenty of notes throughout
■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■

Work on the "full native SVG" version of various controls.
Right now, the base widget and application classes are "getting there", and creating
derived widgets (like progress bars, checkboxes, etc) should be within reach.
Currently, the only published functionality beyond simple buttons relies on embedded
ForeignObjects (and thus HTML) within the Widgets.
■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■

Optimization:
The RealignSiblings is definitely in need of more "smarts" to prevent excess thrashing
of the CPU and visual recalcs, etc when nothing is going to be affected.
Methods like the updateMetrics (FO) are called during ExtendedRealign in cases where
they are not truly needed.  Works, but definitely not optimized.

In addition, the automatic GC seems to not keep up with things over time...
the more the same SVG "app" is open, refreshed, re-run within Dartium, the slower it
gets until browser is closed and re-opened.  The slowdown is most noticable in the
align-to-browser-side(s) visual updates and/or mouse-interaction (moves/sizes) that
tend to get slow and/or unpredictable.  Part of this is likely due to need to optimize
code more; some may be due to Dartium / Dart VM needing further optimizations yet.

■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■

Is there any "built-in" helpful object method(s) in base Dart class to help with
cloning of objects?
Create an Assign() / AssignTo() method to perform deep-copy between objects.
Test this with a simple button-widget and simply change the style on copied one.

■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■

Make sure that any HTML Element(s) within a FO are accessible from the Dart-code in outside
SVG.  In addition, make sure that FO can include script references and execute JS and/or
Dart from within FO, independed of outer SVG.

■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
Implement more "full" tests within this Sample application.
Essentially, bring back the full tests that were in place with JS version.

Test:
- anchors and aligns: are these really working as they should?
- are aligns correct when moves/sizing occur?

FO Testing:
- can I implement a get-body-content from URL()?
  URL sourceURL = ...


■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■

</pre>



<h2>Application</h2>
<pre>Does application need to maintain a "HasFocus" (which widget was last-clicked?)

■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
Figure out why our "canvas" (rect) and/or entire viewport is movable from within
browser during certain times.  No idea.  It is inconsistent too.

■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
Multi-Select using "box" from Canvas (application)... draw a rect, select all Widgets
fully enclosed in box.  Use gray 20% opacity, 2px-border (CSS?) for such rect.
</pre>



<h2>Widget</h2>
<pre>
Widget constraints -- sizing:
  prevent min-size from being less than total of all border-widths, etc.

■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
Widget.EventOptions : callbacks to add/remove event-handlers on SVG objects,
mouse-pointer behavior, etc.  A potentially *simple* way to do this may be setting
the SVG pointer-events attribute to "none" while a particular feature is not available.
Test this approach; if it works, we can leave methods "wired up" and ready, and
enable/disable them via pointer-event changes alone.

■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
Persistence of Widget state/code:
Implement a Widget save/load (though, keep it external to object so as to prevent bloat)?
This is going to be handy for creating an IDE or other projects that use Widgets and
wish to save their locations, etc and restore upon next run, etc.

    
■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■

</pre>
<h3>ScrollBars / etc</h3>
<p>
I have contemplated a FEW ways of implementing scrollable regions.
<br />
Right now, the most promising approach and simplest approach was using DIV's or iFrames
embedded within a FO (ForeignObject).  The plan is to create "native" (SVG-only) version
using appropriate arrangements of fundamental Widget objects (i.e., a meta-object), but
for short-term testing, the FO with HTML inside is fine until other "native" SVG-only
Widgets are ready.
<br />
One thought that crossed my mind along the way was simply: why even use scrollbars?
Who started this? I hate how it requires (aside from mousewheel or special mouse-s/w)
moving to the edge of content to grab a scrollbar.  Why not just have a special key-plus-mouse-movement
combo that is used to do scrolling?  Then, the "scrollbar" could be simply an indicator of relative
position within embedded content... perhaps a simple red-circle that moves up/down, etc.
But, the latter does not reflect relative size of viewing-region vs. total region available
as do modern scrollbars that *size* accordingly.
    
</p>


<h2>HtmlFO Class</h2>
<pre>
Split out the _ScrollOverflow into _ScrollOverflowX/Y and pass through accordingly.
</pre>

<h2>Checkbox / Radio buttons / Radio Group</h2>
<pre>
I have some test code in SVG dir:
    \...\SVG\SVG Examples\MIKE-TESTFILES

Consider how an outermost widget could be the "group" container...
then, another widget within would surround a given radio/checkbox and its text --
ie., those two things would be owned by a widget, such that events like "click" (check/select)
could be placed to fire *anywhere* on the area associated with a given check/radio,
(option "clickAll") OR an option to click label and/or click box/radio only?
Align L/R, etc of checkbox/text.

This would allow for the utmost in nested styling.

</pre>



<h1>BUG-REPORTS TO DEVELOP / RESOLVE<br/>
(Source: Dart, Dartium, Chrome, Webkit, etc.)</h1>
<h2>Source: undetermined yet</h2>
<h3>MouseUp event-handler removal not working</h3>
<p>When I run app from SVG (vs. HTML with embedded SVG), the MouseUp event-handler-removal
code is not working, but it works from within HTML and SVG embedded.  Create a strip-down
test and submit it.  Could be a WebKit issue.</p>


<h2>Source: Dart</h2>
<h3>window.$dom_getComputedStyle : Is this safe to continue relying on?</h3>
See application object notes.
<h3>ViewportElement on SVGSVGElement : NON-FUTURE-based version would be nice</h3>
See application object notes.
<h3>Issue 2856:	SVG Animation added by dart does not work</h3>
see: http://code.google.com/p/dart/issues/detail?id=2856
<p>This may explain some of the issues I had when attempting to get animations to
work properly. But, it does not explain why the pure-CSS animations do not work.
A workaround was mentioned: just add specified script right before closing the body tag:
    script>navigator.webkitStartDart() /script>

</p>
<h3>SUBMITTED: Issue 2977 Related:ElementImplementation behavior fluctuates based on containing doc type (HTML vs. SVG)</h3>
<pre>
    The same Dart code in the attached file "TestInnerHTML.dart" is run from both a standalone SVG document and from
    within an HTML document (SVGContainer.svg, HTMLContainer.html files respectively) by opening either document in
    Dartium.

    When the Dart code runs from HTML, it works fine, but when this same code is run from a standalone SVG file, the
    ElementImplementation errors from not recognizing what the property "innerHTML" is. Notice that the HTML is just a
    wrapper around the *identical* SVG structure.

    So, by having an outer HTML document available, that somehow affects the dart:html library's ability to resolve
    innerHTML on an Element? Something is certainly a bit off here. Issue #772 seems tangentially-related perhaps, but
    does not appear to be the same since my example works fine in an SVG-nested-in-HTML but not in a *standalone* SVG.

    This bug is preventing my codebase from working in standalone SVG files, and I have to "wrap" all my SVGs with the
    bare-minimum html/head/body elements. I.e., using .SVG files are not an option for me until this is fixed.

    ▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪
    There were issues with the .svg() constructor on SVGElement.
    The problem I had appeared perhaps related to Issue 772 (supposedly resolved; I have not tested since though):
    http://code.google.com/p/dart/issues/detail?id=772

    I encountered this at one point and had to switch to using the .tag()
    constructor version instead (which is a bit of a pain by comparison
    when building a decent-sized SVG structure).

    The notes I kept about this:
        "the .svg() constructor technique only works inside HTML docs (vs.
    within pure SVG docs), as the .svg() constructor apparently treats the
    passed in value as "InnerHtml" and the SVG docs don't recognize
    InnerHtml as a property on SVGElement even though they are a sub-
    interface of Element (which is where InnerHtml originates)".

    I.e., the .InnerHtml property on an SVG element works for when I am
    dealing with an HTMLdoc with Embedded SVG doc, but not when .InnerHtml
    is referenced from within a standalone .SVG doc.  Something is
    apparently awry in the SVGElement implementation depending on what doc-
    type "owns" it.
</pre>

<h2>Source: Webkit (probably)</h2>
<h3>Major Issues with ForeignObjects (FOs) in General</h3>
<p>Webkit, and thus Chrome/Dart, have substantial problems with foreign object rendering.
As of Chrome V17/V18/V19/V20... these issues (and more) persist:
</p>
<br />
<ul>
    <li>Chrome: Webkit (presumably) has MAJOR ISSUES with repaint-rect calculations and control-updates with regards to ForeignObjects (FO)
    when the page-zoom-factor is other than 100%!
    Such FO issues have persisted since v17 (repaints not triggered);</li>
    <li>Chrome: Scrollbar(s) on ForeignObjects get hosed if zoom-factor is not 100% &mdash; Chrome thinks the scrollbar is still at
    the position it would be at 100% zoom. Likewise content in non-100%-zoom-regions is not properly refreshed, as Webkit is only repainting some
    arbitrary portion of the area instead.</li>
    <li>Chrome: Cursor-type not honored by browser after mousedown and mousemove begins;</li>
    <li>Chrome: re-use of external SVG-file definitions (of filters,etc) by url(file#def-name) reference does not work (FF gets this right).</li>
    <li><strong>FireFox</strong> (JS version): <b>issues galore!</b>
    <br />No resize (of browser-window) event is ever triggered, thus relative-position (to browser-dimensions) hosed.
    <br />In general, getting the browser-dimensions in FF is nearly impossible.
    <br />Borders not drawing on Widgets (probably position-calc related). Thus, no way to style, move, resize Widgets.
    <br />And much more...</li>
</ul>
<ul>
    <li>iFrame objects within a ForeignObject are not properly scaled when browser zoom-factor is other than 100%.
    Although this is probably the same issue as the prior bullet point (just another sub-bug), it could potentially
    be more than that since the other examples (above) do tend to scale the content up/down with zoom-factor changes
    (albeit with repaint issues and garbled content) whereas the iFrame simply does not resize content (as of v20).</li>
</ul>
<br /><br />

<h3>Other Webkit/Chrome Browser Issues of Note</h3>
<p>Here are some of the various bugs that impact the quality of these SVG Components:

<br />
<ul>
    <li>Cursor-type not honored by browser after mousedown and mousemove begins;
        This is perhaps related to <a href="http://code.google.com/p/chromium/issues/detail?id=103041">Chromium Issue
            103041: Cursor change fires mousemove event</a>.
    </li>
    <li>Re-use of external SVG-file definitions (of filters,etc) by url(file#def-name) reference does not work (FF gets this right).</li>
    <li></li>
</ul>
<br /><br />


<h2>FireFox: Keep these potential issues in mind for future</h2>
<h3>Canvas Resize() Event</h3>
<pre>
There are potential issues with FF not passing resize events (outermost window resizing)
down through to code; i.e., FF is not calling Resize for SVG documents.

    see: https://bugzilla.mozilla.org/show_bug.cgi?id=509795

In general, getting the correct browser-dimensions in FF is nearly impossible, especially with regards to
proper adjustment for region taken up by any scrollbar(s). Thus relative-position (to browser-dimensions),
is totally incorrect.
</pre>
<h3>Other Firefox Issues of note...</h3>
<p>
These are some notes about FireFox issues that were encountered in the (original) JavaScript JS version of these SVG components.
    <ul>
        <li>No resize (of browser-window) event is ever triggered, thus relative-position (to browser-dimensions) hosed.</li>
        <li>In general, getting the (visible window area) browser-dimensions in FF appears nearly impossible.</li>
        <li>Borders not drawing on Widgets (probably position-calc related). Thus, no way to style, move, resize Widgets.</li>
        <li>And much more...</li>
    </ul>
</p>

<h1>MISC DART NOTES</h1>
<p>Refer to <a href="http://www.dartlang.org/docs/language-tour/">Dart Language Tour</a> and similar resources.</p>
<pre>
MISC NOTES:
    A way to embed the native JavaScript code:
    https://groups.google.com/a/dartlang.org/group/misc/browse_thread/thread/fd4cffcc6358ebd8
</pre>

</body>
</html>